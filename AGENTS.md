# Repository Guidelines

## CLI Interface
- `try init [PATH]`: Emits a tiny shell wrapper function for your shell. PATH sets the root (absolute path recommended). The function evals the printed, shell-neutral script to `cd` into selections.
- `try cd [QUERY]`: Launches the interactive selector. If `QUERY` looks like a Git URL, it performs a clone workflow instead. Prints a shell script to stdout; use via the installed function.
- `try . [name]`: Shorthand to create a date-prefixed directory and, if inside a Git repo, add a detached worktree. Optional `name` overrides the basename.
- `try worktree dir [name]`: Same as above but explicit CLI, useful without the shell wrapper.
- `try clone <git-uri> [name]`: Clones into the root. Default name is `YYYY-MM-DD-user-repo` (strips `.git`). Optional `name` overrides.
- Flags: `--path PATH` (for `cd`/`clone`) overrides the root for that call; `--help` prints global help.
- Environment: `TRY_PATH` sets the default root when not using `--path`.
- UI keys: `↑/↓` or `Ctrl-P/N` navigate, `Enter` select, `Backspace` delete char, `Ctrl-D` delete dir (requires typing `YES`), `ESC` cancel.

### Shorthands and Worktrees
- `try .`: Creates a new date-prefixed directory using the current working directory’s basename. If inside a Git repo, a detached worktree is added; otherwise this is a plain directory.

### Shell behavior
- Emitted commands use absolute, quoted paths and are shell-neutral (bash/zsh/fish). Only the wrapper function generated by `init` differs per shell.

## Commit & Pull Request Guidelines
- Commits: short, imperative subject; optional scope. Examples:
  - `fix: reset token clears colors`
  - `ui: improve selected row highlight`
  - `nix: wire Home Manager module`
- PRs: include a clear description, before/after terminal screenshot or asciinema for UI changes, linked issues, and notes on behavior or config (`TRY_PATH`). Update `README.md` when flags, defaults, or UX change.

## Security & Configuration Tips
- `TRY_PATH` controls the workspace root; avoid pointing at sensitive paths.
- Destructive action (delete) requires typing `YES`; keep this safeguard.
- `clone` shells out to `git`; it writes only under `TRY_PATH`.

## Spec System
- `spec/`: Contains markdown specifications and automated tests.
- `spec/*.md`: Human-readable specs defining expected behavior (e.g., `init_spec.md`, `tui_spec.md`, `fuzzy_matching.md`).
- `spec/tests/`: Shell-based test suite that validates implementations against specs.
- `spec/tests/runner.sh`: Test runner that executes all `test_*.sh` files against any `try` binary.
- Run tests: `./spec/tests/runner.sh /path/to/try` (supports wrappers like valgrind).

**Important**: Specs must reflect the full feature set of `try`. They serve as the canonical reference for behavior, enabling new implementations (in any language) to be validated against the same test suite. When adding or changing features, update both the relevant spec markdown and add corresponding tests.


## Directory Scoring Algorithm
- Date prefix bonus: Names starting with `YYYY-MM-DD-` get a base `+2.0`.
- Fuzzy match (when searching):
  - Match is subsequence-based, per-char `+1.0`.
  - Word-boundary bonus `+1.0` when a match starts at index 0 or after non-word.
  - Proximity bonus `+1/√(gap+1)` for consecutive matches.
  - If not all query chars match, score is `0`.
  - Density bonus multiplies by `len(query)/(last_match_index+1)`.
  - Length penalty multiplies by `10/(len(name)+10)` to prefer shorter names.
- Time-based bonuses (always applied):
  - Creation time: `+ 2/√(days_since_created+1)`.
  - Last modified/accessed: `+ 3/√(hours_since_access+1)`.
- Sorting: When no query, items are ordered by the time/date-influenced score; with a query, only matches with positive score appear, sorted descending.